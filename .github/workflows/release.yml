on:
  release:
    types: [published]

jobs:
  notification:
    runs-on: ubuntu-latest
    steps:
      - name: Dump GitHub context
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: echo "$GITHUB_CONTEXT"
      - name: Tokens package
        uses: stormwarning/action-release-notification@v3
        if: startsWith(github.ref, 'refs/tags/@showbie/backpack-tokens')
        with:
          channel: botpark
          message: A new version of *@showbie/backpack-tokens* was just released!
          actions: '[{"text": "View changelog ðŸŽ‰", "url": "https://github.com/showbie/backpack/blob/master/packages/backpack-tokens/CHANGELOG.md"},{"text": "View docs ðŸ“š", "url": "https://design.showbie.com/"}]'
        env:
          SLACKBOT_TOKEN: ${{ secrets.SLACKBOT_TOKEN }}
      - name: Get latest version
        id: latest
        run: |
          echo "::set-output name=pkgver::$(cat ${{ github.workspace }}/package.json | grep version | head -1 | awk -F: '{ print $2 }' | sed 's/[",]//g' | tr -d '[[:space:]]')"
